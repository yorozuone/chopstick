{% extends "/controller/admin/default.twig" %}

{% block area_body_tail %}
<script type="text/javascript">
    // File APIに対応していない場合に表示を隠す
    if (!window.File) {
        document.getElementById('file_upload_section').style.display = "none";
    }
    // ブラウザ上でファイルを展開させない
    function onDragOver(event) {
        event.preventDefault();
    }
    // Drop 領域にドロップしたファイルのプロパティ情報読み取り
    function onDrop(event) {
        // ブラウザ上でファイルを展開させない
        event.preventDefault();
        // ドロップされたファイルの files プロパティ参照
        var files = event.dataTransfer.files;
        for (var i=0; i<files.length; i++) {
            imageFileUpload(files[i]);
        }
    }
    // ファイルアップロード
    function imageFileUpload(f) {
        var formData = new FormData();
        formData.append('cs_media', f);
        $.ajax({
            type: 'POST',
            contentType: false,
            processData: false,
            url: '{{ cs_url('/admin/media/create/upload/', [ dset_media_values.mediafolder_id ]) }}',
            data: formData,
        }).then(
            function(data)
            {
                $('#progress').prepend('<div class="alert alert-success" role="alert">' + data + '</div>');
            },
            function() {
                $('#progress').prepend('<div class="alert alert-danger" role="alert">通信に失敗しました。</div>');
            }
        );
    }
</script>
{% endblock %}

{% block area_body %}

    <div class="page-header">
        <h1>ファイル登録</h1>
    </div>

    <ol class="breadcrumb">
        <li><a href="{{ cs_url('admin/menu') }}">Home</a></li>
        <li><a href="{{ cs_url('admin/mediafolder/summary') }}">フォルダ一覧</a></li>
        <li><a href="{{ cs_url('admin/media/summary', [dset_media_values.mediafolder_id]) }}">ファイル一覧（{{ mediafolder_caption }}）</a></li>
        <li class="active">ファイル登録</li>
    </ol>

    <div  id="file_upload_section" class="panel panel-default" ondragover="onDragOver(event)" ondrop="onDrop(event)">
        <div class="panel-body">
            ファイルをドラッグアンドドロップしてください。
        </div>
    </div>

    <br>
    
    <div id="progress">
    </div>

    <div class="form-group">
        <a href="{{ cs_url('/admin/media/summary', [ dset_media_values.mediafolder_id ]) }}" class="btn btn-default">戻る</a>
    </div>

{% endblock %}
